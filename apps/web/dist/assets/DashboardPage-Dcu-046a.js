import{n as F,S as z,a as $,u as q,r as n,l as G,b as U,j as e,L as R}from"./index-Dk2N0auu.js";import{A as I}from"./AppHeader-6xMXjWpL.js";import{A as K}from"./AboutSrlCanvasModal-uFf4gjX_.js";import{R as W,F as H}from"./FooterNav-Bup6lyCu.js";import{c as O,m as T,R as J}from"./ResultsModal-B669DMWU.js";import"./useDialogA11y-D9iRrHDM.js";const B=r=>{if(!r)return null;const t=new Date(r);return Number.isNaN(t.getTime())?null:t.getTime()},Q=(r,t)=>{const d=F(r),s=d?B(`${d}T00:00:00`):null,i=B(t);return s??i??0};function E(r){return z.map(t=>{var s;const d=(s=r[t.id])==null?void 0:s.score;return typeof d=="number"?d:0})}function X(r){return z.filter(t=>{var d;return typeof((d=r[t.id])==null?void 0:d.score)=="number"}).length}function Y(r){return r.map(t=>{const d=F(t.meta.date),s=E(t.blocks);return{id:t.id,title:t.title,meta:t.meta,updatedAt:t.updated_at,evaluatedAt:d,timelineTimestamp:Q(t.meta.date,t.updated_at),scores:s,metrics:O(s),filledBlocks:X(t.blocks)}}).sort((t,d)=>d.timelineTimestamp-t.timelineTimestamp)}function L(r,t){return{totalDelta:r.metrics.total-t.metrics.total,riskScoreDelta:r.metrics.riskScore-t.metrics.riskScore,cvDelta:r.metrics.cv-t.metrics.cv,completionDelta:r.metrics.completion-t.metrics.completion,filledBlocksDelta:r.filledBlocks-t.filledBlocks}}const Z=[{label:"Baixar Guia de Aplicacao",href:"/downloads/guia-aplicacao-srl-canvas.pdf"},{label:"Baixar SRL Canvas",href:"/downloads/srl-canvas-modelo-manual.pdf"},{label:"Baixar Grafico Radar",href:"/downloads/grafico-radar-srl-canvas.pdf"}];function oe(){const{meta:r,blocks:t,darkMode:d}=$(),{isEnabled:s,user:i}=q(),[P,S]=n.useState(!1),[l,C]=n.useState([]),[k,D]=n.useState(null),[g,u]=n.useState(null),[f,y]=n.useState(null);n.useEffect(()=>{if(!s||!i)return;let a=!0;return G(i.id).then(c=>{if(!a)return;D(null);const h=Y(c);C(h),u(m=>{var w;const N=h.slice(1);return N.length?m&&N.some(_=>_.id===m)?m:((w=N[0])==null?void 0:w.id)??null:null})}).catch(c=>{a&&(D(c instanceof Error?c.message:"Falha ao carregar historico."),C([]),u(null))}),()=>{a=!1}},[s,i]);const A=E(t),x=O(A),M=z.filter(a=>{var c;return typeof((c=t[a.id])==null?void 0:c.score)=="number"}).length,V=U(r),o=l[0]??null,j=n.useMemo(()=>l.find(a=>a.id===g)??null,[g,l]),p=o&&j?L(o,j):null;return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col overflow-x-hidden bg-background-light font-display dark:bg-background-dark",children:[e.jsx(I,{title:"Dashboard"}),e.jsxs("main",{className:"flex-grow space-y-4 px-4 pb-28 pt-6",children:[e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-xs font-semibold text-text-light-secondary dark:text-text-dark-secondary",children:"Canvas Atual"}),e.jsx("button",{type:"button",onClick:()=>y({scores:A,metrics:x}),className:"rounded-lg bg-primary px-3 py-1.5 text-xs font-semibold text-white hover:brightness-110",children:"Ver Resultados"})]}),e.jsx("h2",{className:"mt-1 text-lg font-bold text-text-light-primary dark:text-text-dark-primary",children:V}),e.jsxs("p",{className:"mt-1 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:["Estagio: ",T(x.total)]}),e.jsx("div",{className:"mt-3 h-2.5 w-full overflow-hidden rounded-full bg-zinc-200 dark:bg-zinc-700",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${x.completion}%`}})}),e.jsxs("p",{className:"mt-2 text-xs font-mono text-text-light-secondary dark:text-text-dark-secondary",children:["[",x.total," / 108] - ",M,"/12 blocos preenchidos"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsx("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:"Scorecard de Risco"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-primary",children:x.riskScore.toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsx("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:"Coeficiente de Variacao"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-text-light-primary dark:text-text-dark-primary",children:x.cv.toFixed(2)})]})]})]}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Acoes"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(R,{to:"/canvas",className:"rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white hover:brightness-110",children:"Abrir Meu SRL Canvas"}),e.jsx(R,{to:"/canvas/new",className:"rounded-lg border border-zinc-300 px-4 py-2 text-sm font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:"Novo SRL Canvas"})]})]}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Sobre o Projeto"}),e.jsxs("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:["O nome oficial da ferramenta e"," ",e.jsx("strong",{children:"SRL Canvas (Startup Readiness Level Canvas)"}),". Aqui voce encontra o contexto, proposito e publico-alvo do framework."]}),e.jsx("button",{type:"button",onClick:()=>S(!0),className:"mt-3 rounded-lg border border-zinc-300 px-4 py-2 text-sm font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:"Ler: Por que o SRL Canvas?"})]}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Material de Apoio (Uso Offline)"}),e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Nao e obrigatorio usar esta plataforma para aplicar o SRL Canvas. O metodo foi desenhado para ser simples e agil: voce pode baixar o guia de aplicacao, o modelo do SRL Canvas e o grafico radar para preenchimento manual."}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Z.map(a=>e.jsx("a",{href:a.href,download:!0,target:"_blank",rel:"noreferrer",className:"rounded-lg border border-zinc-300 px-4 py-2 text-sm font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:a.label},a.href))})]}),e.jsx(W,{nextPath:"/dashboard"}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Status de Sincronizacao"}),!s&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Supabase desabilitado. Operando apenas em modo local."}),s&&!i&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Faça login para habilitar sincronizacao automatica do canvas."}),s&&i&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Sincronizacao automatica ativa durante a edicao do canvas."})]}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Historico e Comparativo Temporal"}),!s&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Supabase desabilitado. Historico temporal disponivel apenas no modo remoto."}),s&&!i&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Faça login para visualizar avaliacoes anteriores e comparativos de evolucao."}),s&&i&&e.jsxs("div",{className:"mt-3 space-y-3",children:[k&&e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:["Nao foi possivel carregar o historico: ",k]}),!k&&l.length===0&&e.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Nenhuma avaliacao remota encontrada ainda."}),!k&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsx("p",{className:"text-xs font-semibold text-text-light-secondary dark:text-text-dark-secondary",children:"Avaliacao mais recente"}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:o==null?void 0:o.title}),e.jsxs("p",{className:"mt-1 text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["Atualizado em ",v((o==null?void 0:o.updatedAt)??"")]}),e.jsxs("p",{className:"mt-1 text-xs font-mono text-text-light-secondary dark:text-text-dark-secondary",children:["[",(o==null?void 0:o.metrics.total)??0," / 108] -"," ",(o==null?void 0:o.filledBlocks)??0,"/12 blocos preenchidos"]})]}),l.length>1&&e.jsxs("div",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsxs("label",{className:"block text-xs font-medium text-text-light-secondary dark:text-text-dark-secondary",children:["Comparar com",e.jsx("select",{className:"mt-1 block w-full rounded-md border-zinc-300 bg-white p-2 text-sm text-text-light-primary focus:border-primary focus:ring-primary dark:border-zinc-700 dark:bg-zinc-900 dark:text-text-dark-primary",value:g??"",onChange:a=>u(a.target.value),children:l.slice(1).map(a=>e.jsxs("option",{value:a.id,children:[a.title," (",v(a.updatedAt),")"]},a.id))})]}),p&&j&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 text-xs sm:grid-cols-2",children:[e.jsxs("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:["Delta Total:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:b(p.totalDelta,0)})]}),e.jsxs("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:["Delta Scorecard:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:b(p.riskScoreDelta,2)})]}),e.jsxs("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:["Delta CV:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:b(p.cvDelta,2)})]}),e.jsxs("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:["Delta Blocos Preenchidos:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:b(p.filledBlocksDelta,0)})]})]})]}),e.jsx("div",{className:"space-y-2",children:l.map((a,c)=>{const h=l[c+1],m=h?L(a,h).riskScoreDelta:null;return e.jsxs("article",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:a.title}),e.jsxs("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["Estagio: ",T(a.metrics.total)]}),e.jsxs("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["Atualizado em ",v(a.updatedAt)]})]}),e.jsx("button",{type:"button",onClick:()=>y({scores:a.scores,metrics:a.metrics}),className:"rounded-md border border-zinc-300 px-2 py-1 text-xs font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:"Ver Resultados"})]}),e.jsxs("p",{className:"mt-2 text-xs font-mono text-text-light-secondary dark:text-text-dark-secondary",children:["[",a.metrics.total," / 108] - ",a.filledBlocks,"/12 blocos preenchidos | Scorecard: ",a.metrics.riskScore.toFixed(2)," | CV:"," ",a.metrics.cv.toFixed(2)]}),m!==null&&e.jsxs("p",{className:"mt-1 text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["Evolucao do Scorecard vs avaliacao anterior:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:b(m,2)})]})]},a.id)})})]})]})]})]}),e.jsx(H,{}),f&&e.jsx(J,{darkMode:d,metrics:f.metrics,scores:f.scores,onClose:()=>y(null)}),e.jsx(K,{isOpen:P,onClose:()=>S(!1)})]})}function v(r){const t=new Date(r);return Number.isNaN(t.getTime())?r:t.toLocaleString("pt-BR")}function b(r,t){return`${r>0?"+":""}${r.toFixed(t)}`}export{oe as DashboardPage};
