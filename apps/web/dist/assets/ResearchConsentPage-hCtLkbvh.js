import{c as I,p as P,u as w,r,R as E,j as e,N as L}from"./index-D3aoGXCM.js";import{A as q}from"./AppHeader-ChEPhaZr.js";import{g as _,b as F,c as a,d as M,F as H,e as O,r as D}from"./FooterNav-DnmtxKHu.js";import"./useDialogA11y-DrFaqcae.js";function V(d){if(!d)return"-";const i=new Date(d);return Number.isNaN(i.getTime())?d:i.toLocaleString("pt-BR")}function Y(){const d=I(),[i]=P(),{user:s}=w(),c=i.get("next")||"/canvas",S=r.useMemo(()=>`/survey?next=${encodeURIComponent(c)}`,[c]),h=E.enabled,[b,j]=r.useState(!0),[k,y]=r.useState(!1),[f,v]=r.useState(!1),[g,l]=r.useState(null),[u,n]=r.useState(null),[R,x]=r.useState(null),[p,C]=r.useState(null),[N,m]=r.useState(!1);if(r.useEffect(()=>{if(!h){m(!1),x(null),n(null),j(!1);return}let t=!0;return _((s==null?void 0:s.id)??null).then(o=>{t&&(m(o.accepted),x(o.acceptedAt),n(null))}).catch(o=>{t&&n(o instanceof Error?o.message:"Falha ao carregar status do TCLE.")}).finally(()=>{t&&j(!1)}),()=>{t=!1}},[h,s==null?void 0:s.id]),!h)return e.jsx(L,{replace:!0,to:c});const A=async()=>{y(!0),n(null),l(null);try{const t=await O({userId:(s==null?void 0:s.id)??null,nextPath:c});C(t),m(!0),x(new Date().toISOString()),l("Consentimento registrado com sucesso."),d(S)}catch(t){n(t instanceof Error?t.message:"Falha ao registrar consentimento.")}finally{y(!1)}},z=async()=>{v(!0),n(null),l(null);try{await D((s==null?void 0:s.id)??null),m(!1),x(null),C(null),l("Consentimento revogado. A pesquisa nao podera ser enviada sem novo aceite.")}catch(t){n(t instanceof Error?t.message:"Falha ao revogar consentimento.")}finally{v(!1)}};return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col overflow-x-hidden bg-background-light font-display dark:bg-background-dark",children:[e.jsx(q,{title:"TCLE - Pesquisa Academica",backTo:c}),e.jsxs("main",{className:"flex-grow space-y-4 px-4 pb-28 pt-6",children:[e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h2",{className:"text-base font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Termo de Consentimento Livre e Esclarecido (TCLE)"}),e.jsxs("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:["Versao de consentimento: ",e.jsx("strong",{children:F})]}),e.jsxs("p",{className:"mt-1 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:["Versao do questionario: ",e.jsx("strong",{children:E.activeVersion})]}),e.jsxs("div",{className:"mt-3 space-y-1 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Titulo da pesquisa:"})," ",a.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pesquisador responsavel:"})," ",a.researcher]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contato do pesquisador:"})," ",a.researcherContact]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Orientador:"})," ",a.advisor]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Instituicao proponente:"})," ",a.institution]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Programa:"})," ",a.program]})]})]}),M.map(t=>e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:[t.id,". ",t.title]}),e.jsx("div",{className:"mt-2 space-y-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:t.paragraphs.map((o,T)=>e.jsx("p",{children:o},`${t.id}_${T}`))})]},t.id)),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Informacoes eticas e de protecao de dados"}),e.jsxs("div",{className:"mt-2 space-y-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Comite de Etica:"})," ",a.ethicsCommittee.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contato CEP:"})," ",a.ethicsCommittee.contact]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Endereco CEP:"})," ",a.ethicsCommittee.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DPO/Encarregada IFMS:"})," ",a.dpo]}),e.jsx("p",{children:"Ao continuar, voce declara que leu e compreendeu o TCLE e concorda em participar da pesquisa de forma livre e voluntaria."})]})]}),b&&e.jsx("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 text-sm text-text-light-secondary dark:border-zinc-800/80 dark:bg-card-dark dark:text-text-dark-secondary",children:"Carregando status do consentimento..."}),!b&&e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Declaracao de aceite"}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Status atual:"})," ",N?"Consentimento ativo":"Sem consentimento ativo"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Registrado em:"})," ",V(R)]}),p&&e.jsxs("p",{children:[e.jsx("strong",{children:"Protocolo:"})," ",p.id," (",p.storage,")"]})]}),(g||u)&&e.jsxs("div",{className:"mt-3 space-y-1",children:[g&&e.jsx("p",{className:"text-xs text-emerald-700 dark:text-emerald-300",children:g}),u&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-300",children:u})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",onClick:A,disabled:k,className:"rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white hover:brightness-110 disabled:cursor-not-allowed disabled:opacity-60",children:k?"Registrando...":"Concordo e continuar para pesquisa"}),e.jsx("button",{type:"button",onClick:()=>d(c),className:"rounded-lg border border-zinc-300 px-4 py-2 text-sm font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:"Nao concordo"}),N&&e.jsx("button",{type:"button",onClick:z,disabled:f,className:"rounded-lg border border-red-300 px-4 py-2 text-sm font-semibold text-red-700 hover:bg-red-50 disabled:cursor-not-allowed disabled:opacity-60 dark:border-red-700/50 dark:text-red-300 dark:hover:bg-red-900/20",children:f?"Revogando...":"Revogar consentimento"})]})]})]}),e.jsx(H,{})]})}export{Y as ResearchConsentPage};
