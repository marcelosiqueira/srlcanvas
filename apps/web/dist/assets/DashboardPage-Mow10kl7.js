import{n as $,b as V,S as A,a as H,u as I,r as n,l as K,j as e,L as E}from"./index-D3aoGXCM.js";import{A as W}from"./AppHeader-ChEPhaZr.js";import{A as J}from"./AboutSrlCanvasModal-Wgm-bpx1.js";import{R as Q,F as X}from"./FooterNav-DnmtxKHu.js";import{c as _,m as M,R as Y}from"./ResultsModal-DGax47be.js";import"./useDialogA11y-DrFaqcae.js";const O=t=>{if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s.getTime()},Z=(t,s)=>{const i=$(t),r=i?O(`${i}T00:00:00`):null;return O(s)??r??0},ee=t=>{const s=t.meta.startup.trim().toLowerCase(),i=t.meta.evaluator.trim().toLowerCase(),r=t.evaluatedAt??"",d=t.scores.join(",");return`${s}|${i}|${r}|${d}`};function q(t){return A.map(s=>{var r;const i=(r=t[s.id])==null?void 0:r.score;return typeof i=="number"?i:0})}function te(t){return A.filter(s=>{var i;return typeof((i=t[s.id])==null?void 0:i.score)=="number"}).length}function ae(t){const s=t.map(r=>{const d=$(r.meta.date),b=q(r.blocks);return{id:r.id,title:V(r.meta),meta:r.meta,updatedAt:r.updated_at,evaluatedAt:d,timelineTimestamp:Z(r.meta.date,r.updated_at),scores:b,metrics:_(b),filledBlocks:te(r.blocks)}}).sort((r,d)=>d.timelineTimestamp-r.timelineTimestamp),i=new Set;return s.filter(r=>{const d=ee(r);return i.has(d)?!1:(i.add(d),!0)})}function f(t,s){return{totalDelta:t.metrics.total-s.metrics.total,riskScoreDelta:t.metrics.riskScore-s.metrics.riskScore,cvDelta:t.metrics.cv-s.metrics.cv,completionDelta:t.metrics.completion-s.metrics.completion,filledBlocksDelta:t.filledBlocks-s.filledBlocks}}const re=[{label:"Baixar Guia de Aplicacao",href:"/downloads/guia-aplicacao-srl-canvas.pdf"},{label:"Baixar SRL Canvas",href:"/downloads/srl-canvas-modelo-manual.pdf"},{label:"Baixar Grafico Radar",href:"/downloads/grafico-radar-srl-canvas.pdf"}];function ne(){const{meta:t,blocks:s,darkMode:i}=H(),{isEnabled:r,user:d}=I(),[b,w]=n.useState(!1),[c,R]=n.useState([]),[k,T]=n.useState(null),[j,N]=n.useState(null),[v,z]=n.useState(null);n.useEffect(()=>{if(!r||!d)return;let a=!0;return K(d.id).then(l=>{if(!a)return;T(null);const m=ae(l);R(m),N(p=>{var F;const L=m[0],C=L?m.slice(1).filter(D=>P(f(L,D))):[];return C.length?p&&C.some(D=>D.id===p)?p:((F=C[0])==null?void 0:F.id)??null:null})}).catch(l=>{a&&(T(l instanceof Error?l.message:"Falha ao carregar historico."),R([]),N(null))}),()=>{a=!1}},[r,d]);const B=q(s),x=_(B),G=A.filter(a=>{var l;return typeof((l=s[a.id])==null?void 0:l.score)=="number"}).length,U=V(t),o=c[0]??null,h=n.useMemo(()=>o?c.slice(1).filter(a=>P(f(o,a))):[],[c,o]),S=n.useMemo(()=>h.find(a=>a.id===j)??null,[h,j]),u=o&&S?f(o,S):null;return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col overflow-x-hidden bg-background-light font-display dark:bg-background-dark",children:[e.jsx(W,{title:"Dashboard"}),e.jsxs("main",{className:"flex-grow space-y-4 px-4 pb-28 pt-6",children:[e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-xs font-semibold text-text-light-secondary dark:text-text-dark-secondary",children:"Canvas Atual"}),e.jsx("button",{type:"button",onClick:()=>z({scores:B,metrics:x}),className:"rounded-lg bg-primary px-3 py-1.5 text-xs font-semibold text-white hover:brightness-110",children:"Ver Resultados"})]}),e.jsx("h2",{className:"mt-1 text-lg font-bold text-text-light-primary dark:text-text-dark-primary",children:U}),o&&e.jsxs("p",{className:"mt-1 text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["(Atualizado ",y(o.updatedAt),")"]}),e.jsxs("p",{className:"mt-1 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:["Estagio: ",M(x.total)]}),e.jsx("div",{className:"mt-3 h-2.5 w-full overflow-hidden rounded-full bg-zinc-200 dark:bg-zinc-700",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${x.completion}%`}})}),e.jsxs("p",{className:"mt-2 text-xs font-mono text-text-light-secondary dark:text-text-dark-secondary",children:["[",x.total," / 108] - ",G,"/12 blocos preenchidos"]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsx("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:"Scorecard de Risco"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-primary",children:x.riskScore.toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsx("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:"Coeficiente de Variacao"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-text-light-primary dark:text-text-dark-primary",children:x.cv.toFixed(2)})]})]})]}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Acoes"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(E,{to:"/canvas",className:"rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white hover:brightness-110",children:"Abrir Meu SRL Canvas"}),e.jsx(E,{to:"/canvas/new",className:"rounded-lg border border-zinc-300 px-4 py-2 text-sm font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:"Novo SRL Canvas"})]})]}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h2",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Sobre o Projeto"}),e.jsxs("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:["O nome oficial da ferramenta e"," ",e.jsx("strong",{children:"SRL Canvas (Startup Readiness Level Canvas)"}),". Aqui voce encontra o contexto, proposito e publico-alvo do framework."]}),e.jsx("button",{type:"button",onClick:()=>w(!0),className:"mt-3 rounded-lg border border-zinc-300 px-4 py-2 text-sm font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:"Ler: Por que o SRL Canvas?"})]}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Material de Apoio (Uso Offline)"}),e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Nao e obrigatorio usar esta plataforma para aplicar o SRL Canvas. O metodo foi desenhado para ser simples e agil: voce pode baixar o guia de aplicacao, o modelo do SRL Canvas e o grafico radar para preenchimento manual."}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:re.map(a=>e.jsx("a",{href:a.href,download:!0,target:"_blank",rel:"noreferrer",className:"rounded-lg border border-zinc-300 px-4 py-2 text-sm font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:a.label},a.href))})]}),e.jsx(Q,{nextPath:"/dashboard"}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Status de Sincronizacao"}),!r&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Supabase desabilitado. Operando apenas em modo local."}),r&&!d&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Faça login para habilitar sincronizacao automatica do canvas."}),r&&d&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Sincronizacao automatica ativa durante a edicao do canvas."})]}),e.jsxs("section",{className:"rounded-xl border border-zinc-200/80 bg-card-light p-4 dark:border-zinc-800/80 dark:bg-card-dark",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Historico e Comparativo Temporal"}),e.jsxs("div",{className:"mt-2 rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 text-xs text-text-light-secondary dark:border-zinc-800/80 dark:bg-zinc-800/70 dark:text-text-dark-secondary",children:[e.jsx("p",{className:"font-semibold text-text-light-primary dark:text-text-dark-primary",children:"Como usar este comparativo"}),e.jsxs("p",{className:"mt-1",children:["A avaliacao mais recente e a referencia. Em ",e.jsx("strong",{children:"Comparar com"}),", selecione uma avaliacao anterior do seu historico para ver a evolucao."]}),e.jsxs("p",{className:"mt-1",children:["Delta ",e.jsx("strong",{children:"positivo"})," em Total/Scorecard indica melhoria. Em CV, valores",e.jsx("strong",{children:" negativos"})," indicam maior equilibrio entre blocos."]})]}),!r&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Supabase desabilitado. Historico temporal disponivel apenas no modo remoto."}),r&&!d&&e.jsx("p",{className:"mt-2 text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Faça login para visualizar avaliacoes anteriores e comparativos de evolucao."}),r&&d&&e.jsxs("div",{className:"mt-3 space-y-3",children:[k&&e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:["Nao foi possivel carregar o historico: ",k]}),!k&&c.length===0&&e.jsx("p",{className:"text-sm text-text-light-secondary dark:text-text-dark-secondary",children:"Nenhuma avaliacao remota encontrada ainda."}),!k&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsx("p",{className:"text-xs font-semibold text-text-light-secondary dark:text-text-dark-secondary",children:"Avaliacao mais recente"}),e.jsxs("p",{className:"mt-1 text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:[o==null?void 0:o.title," (Atualizado"," ",y((o==null?void 0:o.updatedAt)??""),")"]}),e.jsxs("p",{className:"mt-1 text-xs font-mono text-text-light-secondary dark:text-text-dark-secondary",children:["[",(o==null?void 0:o.metrics.total)??0," / 108] -"," ",(o==null?void 0:o.filledBlocks)??0,"/12 blocos preenchidos"]})]}),h.length>0&&e.jsxs("div",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsxs("label",{className:"block text-xs font-medium text-text-light-secondary dark:text-text-dark-secondary",children:["Comparar com",e.jsx("select",{className:"mt-1 block w-full rounded-md border-zinc-300 bg-white p-2 text-sm text-text-light-primary focus:border-primary focus:ring-primary dark:border-zinc-700 dark:bg-zinc-900 dark:text-text-dark-primary",value:j??"",onChange:a=>N(a.target.value),children:h.map(a=>e.jsxs("option",{value:a.id,children:[a.title," (Atualizado ",y(a.updatedAt),")"]},a.id))})]}),u&&S&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 text-xs sm:grid-cols-2",children:[e.jsxs("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:["Delta Total:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:g(u.totalDelta,0)})]}),e.jsxs("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:["Delta Scorecard:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:g(u.riskScoreDelta,2)})]}),e.jsxs("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:["Delta CV:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:g(u.cvDelta,2)})]}),e.jsxs("p",{className:"text-text-light-secondary dark:text-text-dark-secondary",children:["Delta Blocos Preenchidos:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:g(u.filledBlocksDelta,0)})]})]})]}),c.length>1&&h.length===0&&e.jsx("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:"Nenhuma avaliacao anterior com diferenca de metricas para comparar."}),e.jsx("div",{className:"space-y-2",children:c.map((a,l)=>{const m=c[l+1],p=m?f(a,m).riskScoreDelta:null;return e.jsxs("article",{className:"rounded-lg border border-zinc-200/80 bg-zinc-50 p-3 dark:border-zinc-800/80 dark:bg-zinc-800/70",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-text-light-primary dark:text-text-dark-primary",children:[a.title," (Atualizado ",y(a.updatedAt),")"]}),e.jsxs("p",{className:"text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["Estagio: ",M(a.metrics.total)]})]}),e.jsx("button",{type:"button",onClick:()=>z({scores:a.scores,metrics:a.metrics}),className:"rounded-md border border-zinc-300 px-2 py-1 text-xs font-semibold text-text-light-secondary hover:bg-zinc-100 dark:border-zinc-700 dark:text-text-dark-secondary dark:hover:bg-zinc-800",children:"Ver Resultados"})]}),e.jsxs("p",{className:"mt-2 text-xs font-mono text-text-light-secondary dark:text-text-dark-secondary",children:["[",a.metrics.total," / 108] - ",a.filledBlocks,"/12 blocos preenchidos | Scorecard: ",a.metrics.riskScore.toFixed(2)," | CV:"," ",a.metrics.cv.toFixed(2)]}),p!==null&&e.jsxs("p",{className:"mt-1 text-xs text-text-light-secondary dark:text-text-dark-secondary",children:["Evolucao do Scorecard vs avaliacao anterior:"," ",e.jsx("strong",{className:"text-text-light-primary dark:text-text-dark-primary",children:g(p,2)})]})]},a.id)})})]})]})]})]}),e.jsx(X,{}),v&&e.jsx(Y,{darkMode:i,metrics:v.metrics,scores:v.scores,onClose:()=>z(null)}),e.jsx(J,{isOpen:b,onClose:()=>w(!1)})]})}function y(t){const s=new Date(t);return Number.isNaN(s.getTime())?t:s.toLocaleString("pt-BR")}function P(t){return t.totalDelta!==0||Math.abs(t.riskScoreDelta)>1e-4||Math.abs(t.cvDelta)>1e-4||t.filledBlocksDelta!==0}function g(t,s){return`${t>0?"+":""}${t.toFixed(s)}`}export{ne as DashboardPage};
