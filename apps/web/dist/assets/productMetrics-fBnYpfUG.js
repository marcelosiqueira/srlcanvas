function y(e,t){return t}const m={enabled:y(void 0,!0)},i="srl-product-metrics-v1",v=1200,E={canvas_started:{description:"Inicio de sessao de avaliacao no canvas.",payloadFields:["sessionId","scopeType","supabaseEnabled","advancedMode"]},canvas_completed:{description:"Conclusao de avaliacao com 12 blocos pontuados.",payloadFields:["sessionId","filledBlocks","completionPercent","advancedMode"]},canvas_abandoned:{description:"Saida do canvas sem concluir 12 blocos.",payloadFields:["sessionId","filledBlocks","stage"]},survey_started:{description:"Inicio de sessao da survey academica.",payloadFields:["sessionId","startedWithDraft"]},survey_step_viewed:{description:"Visualizacao de etapa da survey.",payloadFields:["sessionId","stepKey","stepIndex","stepCount"]},survey_completed:{description:"Envio concluido da survey academica.",payloadFields:["sessionId","eligible","stepCount","completionSeconds","storage"]},survey_step_abandoned:{description:"Abandono da survey na etapa corrente.",payloadFields:["sessionId","stepKey","reason"]}};function D(e){const t=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2,11);return`${e}_${t}`}function _(){return`evt_${typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2,11)}`}function N(e){return e<=0?"metadata":e<=4?"early_blocks":e<=8?"mid_blocks":"late_blocks"}function b(e){if(!e)return[];try{const t=JSON.parse(e);return Array.isArray(t)?t.filter(n=>{if(typeof n!="object"||n===null)return!1;const o=n;return typeof o.id=="string"&&typeof o.name=="string"&&typeof o.timestamp=="string"&&typeof o.payload=="object"&&o.payload!==null}):[]}catch{return[]}}function p(){return typeof window>"u"?[]:b(window.localStorage.getItem(i))}function S(e){if(typeof window>"u")return;const t=e.slice(-2e3);window.localStorage.setItem(i,JSON.stringify(t))}function g(e,t){const n=e[e.length-1];if(!n||n.name!==t.name)return!1;const o=n.payload,a=t.payload;if(o.sessionId!==a.sessionId||JSON.stringify(n.payload)!==JSON.stringify(t.payload))return!1;const r=new Date(n.timestamp).getTime(),d=new Date(t.timestamp).getTime();return Number.isNaN(r)||Number.isNaN(d)?!1:d-r<=v}function P(e,t){if(!m.enabled||typeof window>"u")return;const n=new Date().toISOString(),o={id:_(),name:e,timestamp:n,payload:t},a=p();g(a,o)||(a.push(o),S(a))}function I(){return p()}function C(){typeof window>"u"||window.localStorage.removeItem(i)}function l(e,t){return e<=0?0:Number((t/e*100).toFixed(1))}function s(e,t){return new Set(e.filter(n=>n.name===t).map(n=>n.payload.sessionId)).size}function w(){return{triage:0,profile:0,dimensions_1_4:0,dimensions_5_8:0,dimensions_9_12:0,scale_and_sus:0,adoption_and_followup:0}}function M(e=I()){const t=s(e,"canvas_started"),n=s(e,"canvas_completed"),o=s(e,"canvas_abandoned"),a=s(e,"survey_started"),r=s(e,"survey_completed"),d=s(e,"survey_step_abandoned"),c=w();for(const u of e){if(u.name!=="survey_step_abandoned")continue;const f=u.payload.stepKey;c[f]+=1}return{generatedAt:new Date().toISOString(),totalEvents:e.length,canvas:{started:t,completed:n,abandoned:o,completionRate:l(t,n)},survey:{started:a,completed:r,abandoned:d,completionRate:l(a,r),abandonedByStep:c}}}export{E as P,C as a,M as b,D as c,N as g,P as t};
